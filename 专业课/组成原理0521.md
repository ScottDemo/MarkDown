## 第八章 CPU

### 8.1 CPU的结构

#### 一、CPU的功能（指令控制-操作控制-时间控制-处理中断-数据加工）

##### 1. 控制器的功能

- 取指令
- 分析指令
- 执行指令，发出各种操作指令
- 控制程序输入及结果的输出
- 总线管理
- 处理异常情况和特殊请求

##### 2. 运算器的功能

- 实现算术运算和逻辑运算

#### 二、CPU结构框图

##### 1. CPU与系统总线

- 指令控制		PC	IR
- 操作==控制		PC	IR==
- 时间==控制		PC	IR==
- 数据==控制		PC	IR==
- 处理==控制		PC	IR==

##### 2. CPU的内部结构

![CPU的内部结构](E:\MarkDown\专业课\计算机组成原理图床\CPU的内部结构.png)

#### 三、CPU内部的寄存器

##### 1. 用户（低级语言程序员）可见的寄存器

- 通用寄存器
  - 存放操作数
  - 可作某种寻址方式所需的专用寄存器
- 数据寄存器
  - 存放操作数（满足各种数据类型）
  - 两个寄存器拼接存放双倍字长数据

- 地址寄存器
  - 存放地址，其位数应满足最大的地址范围
  - 用于特殊的寻址方式  段基址  栈指针

- 条件码寄存器
  - 存放条件码，可作程序分支的依据

##### 2. 控制和状态寄存器

- 控制寄存器
  - PC → MAR → M → MDR → IR
  - 控制CPU操作
    - 其中MAR、MDR、IR 用户不可见，PC用户可见

- 状态寄存器
  - 状态寄存器	存放条件码
  - PSW寄存器	==存放条件码==

#### 四、控制单元CU和中断系统

##### 1. CU	产生全部指令的微操作命令序列

组合逻辑设计		硬连线逻辑

微程序设计		存储逻辑

##### 2. 中断系统

### 8.2 指令周期

#### 一、指令周期的基本概念

##### 1. 指令周期

==取出并执行一条指令所需要的全部时间==

==完成一条指令==

##### 2. 每条指令的指令周期不同

##### 3. 具有间接寻址的指令周期

![间接寻址指令周期](E:\MarkDown\专业课\计算机组成原理图床\间接寻址指令周期.png)

##### 4. 带有中断周期的指令周期

![中断周期指令周期](E:\MarkDown\专业课\计算机组成原理图床\中断周期指令周期.png)

##### 5. 指令周期流程

![指令周期流程](E:\MarkDown\专业课\计算机组成原理图床\指令周期流程.png)

##### 6. CPU工作周期的标志

CPU访存有4种性质

- 取    指令	    取值周期
- 取    地址            间址周期
- 取    操作数        执行周期
- 存    程序断点    中断周期

#### 二、指令周期的数据流

##### 1. 取指周期数据流（6步）

![取指周期数据流](E:\MarkDown\专业课\计算机组成原理图床\取指周期数据流.png)

- PC→ MAR
- 1→ R
- M→ MDR
- MDR→ IR
- (PC)+1 → PC
- Δp(IR) → CU

##### 2. 间址周期数据流

##### 3. 执行周期数据流

- 不同指令的执行周期数据流不同

##### 4. 中断周期数据流

### 8.3 指令流水（以后讲）

### 8.4 中断系统

#### 一、中断的概念

#### 二、I/O中断的产生

![IO中断](E:\MarkDown\专业课\计算机组成原理图床\IO中断.png)

##### 2. 中断系统需解决的问题

1. 各中断源如何向CPU提出请求？
2. 各中断源同时提出请求怎么办？
3. CPU什么条件、什么时间、以什么方式响应中断？
4. 如何保护现场？
5. 如何寻找入口地址？
6. 如何恢复现场，如何返回？
7. 处理中断过程中又出现新的中断怎么办？

#### 二、中断请求标记和中断判优逻辑

##### 1. 中断请求标记		INTR

==一个请求源==	

==组成中断请求标记寄存器==

##### 2. 中断判优逻辑

1. 硬件实现（排队器）

- 分散在各个中断源的接口电路中		链式排队器
- 集中在CPU内
- ![集中在CPU内.png](E:\MarkDown\专业课\计算机组成原理图床\集中在CPU内.png)

2. 软件实现（程序查询）

- ![软件判优](E:\MarkDown\专业课\计算机组成原理图床\软件判优.png)

###### 三、程序中断方式的接口电路

1. 配置中断请求触发器和中断屏蔽触发器

![配置中断请求触发器和中断屏蔽触发器](E:\MarkDown\专业课\计算机组成原理图床\配置中断请求触发器和中断屏蔽触发器.png)

2. 排队器

#### 三、中断服务程序入口地址的寻找

1. 硬件向量法

![硬件向量法](E:\MarkDown\专业课\计算机组成原理图床\硬件向量法.png)

2. 软件查询法

![软件查询法.png](E:\MarkDown\专业课\计算机组成原理图床\软件查询法.png)

#### 四、中断响应

1. 响应中断的条件

   允许中断触发器 EINT = 1

2. 响应中断的时间

   指令执行周期结束时刻由CPU发信号查询

![响应中断时间.png](E:\MarkDown\专业课\计算机组成原理图床\响应中断时间.png)

3. 中断隐指令

   (1). 保护程序断点

   ​	断电存于特定地址（0号地址）内	断点进栈

   (2). 寻找服务程序入口地址

   向量地址 → PC（硬件向量法）

   中断识别程序 入口地址 M→ PC（软件查询法）

   (3). 硬件 关中断

   ![关中断.png](E:\MarkDown\专业课\计算机组成原理图床\关中断.png)

#### 五、保护现场和恢复现场

1. 保护现场

$$
保护现场\begin{cases}
断点& 中断隐指令完成\\
寄存器内容&中断服务程序完成
\end{cases}
$$

2. 恢复现场		中断服务程序完成

![恢复现场](E:\MarkDown\专业课\计算机组成原理图床\恢复现场.png)

#### 六、中断屏蔽技术

1. 多重中断的概念

2. 实现多重中断的条件

   (1). 提前设置开中断指令

   (2). 优先级别高的中断源有权中优先级低的中断源

3. 屏蔽技术

   (1). 屏蔽触发器的作用

   ![屏蔽触发器的作用](E:\MarkDown\专业课\计算机组成原理图床\屏蔽触发器的作用.png)

   (2). 屏蔽字

![屏蔽字.png](E:\MarkDown\专业课\计算机组成原理图床\屏蔽字.png)

​	==(3). ==

4. 多重中断的断点保护

   (1).断点进栈

   (2). 断点存入“0”地址

   ​	中断周期 0 → MAR

   ​	命令存储器写

   ​	PC → MDR	断点 → MDR

   ​	(MDR) → 存入存储器

   三次中断，三个断点都存入“0”地址

   (3). 程序断点存入“0”地址的断点保护

![程序断点存入"0"地址的断点保护](E:\MarkDown\专业课\计算机组成原理图床\程序断点存入0地址的断点保护.png)













































